{#
Style and button changes from the default.
This way, it hides the 'resource' from the user completely.
The only resource or the HTML link or the CIF file, which can be downloadable.
#}

<style>
resource-item a,
.resource-item a:hover {
  text-decoration: none;
}
</style>
{% set url_action = pkg.type ~ ('_resource.edit' if url_is_edit and can_edit else '_resource.read') %}
{% set url = h.url_for(url_action, id=pkg.id if is_activity_archive else pkg.name, resource_id=res.id, **({'activity_id': request.args['activity_id']} if 'activity_id' in request.args else {})) %}

<li class="resource-item" data-id="{{ res.id }}">
  {% block resource_item_title %}
  <a class="heading" title="{{ res.name or res.description }}">
    {{ h.resource_display_name(res) | truncate(50) }}<span class="format-label" property="dc:format" data-format="{{ res.format.lower() or 'data' }}">{{ h.get_translated(res, 'format') }}</span>
    {{ h.popular('views', res.tracking_summary.total, min=10) if res.tracking_summary }}
  </a>
  {% endblock %}
  {% block resource_item_description %}
    <p class="description">
      {% if res.description %}
        {{ h.markdown_extract(h.get_translated(res, 'description'), extract_length=80) }}
      {% endif %}
    </p>
  {% endblock %}

 {# templates/package/snippets/resource_item.html #}
{% block resource_item_explore %}
  {% set is_upload = (res.url_type == 'upload') %}
  {# Where to send users for a direct "source" click #}
  {% set go_url = res.url if (res.url and h.is_url(res.url)) else url %}

  {% if is_upload %}
    {# ---- Any uploaded file (pdf/doc/cif/xlsx/...): dropdown ---- #}
    <div class="btn-group">
      <a class="btn btn-primary dropdown-toggle" data-toggle="dropdown" href="#"
         aria-haspopup="true" aria-expanded="false">
        <i class="fa fa-share"></i> {{ _('Resource') }} <span class="caret"></span>
      </a>
      <ul class="dropdown-menu">
        {% if not is_activity_archive and res.has_views %}
          <li>
            <a href="{{ url }}">
              <i class="fa fa-bar-chart-o"></i> {{ _('Preview') }}
            </a>
          </li>
        {% endif %}
        <li>
          <a href="{{ res.url }}" class="resource-url-analytics" target="_blank" rel="noopener">
            <i class="fa fa-arrow-circle-o-down"></i> {{ _('Download') }}
          </a>
        </li>
        {% if can_edit %}
          <li>
            <a href="{{ h.url_for(pkg.type ~ '_resource.edit', id=pkg.name, resource_id=res.id) }}">
              <i class="fa fa-pencil-square-o"></i> {{ _('Edit') }}
            </a>
          </li>
        {% endif %}
      </ul>
    </div>
  {% else %}
    {# ---- Non-upload (e.g., HTML/external resource): direct button + optional Edit ---- #}
    <div class="btn-group">
      <a class="btn btn-primary resource-url-analytics"
         href="{{ go_url }}" target="_blank" rel="noopener">
        <i class="fa fa-external-link"></i> {{ _('Go to source') }}
      </a>
      {% if can_edit %}
        <a class="btn btn-default"
           href="{{ h.url_for(pkg.type ~ '_resource.edit', id=pkg.name, resource_id=res.id) }}">
          <i class="fa fa-pencil-square-o"></i> {{ _('Edit') }}
        </a>
      {% endif %}
    </div>
  {% endif %}
{% endblock %}

</li>
